<!DOCTYPE html>
<html>
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2JHM7SP9CG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2JHM7SP9CG');
</script>
  <title>Semester Papers</title>
</head>
<link rel="stylesheet" type="text/css" href="styles.css">

<body>
<center>
  <h1 style="margin-top: 0;" id="title"></h1>

  <div id="papers"></div>

  <!-- Supabase JS SDK -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>
      
  // Initialize Supabase client
  const Supabase = supabase.createClient(
    "https://irpdlkhewvvqjperruxt.supabase.co",   // Replace with your Project URL
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlycGRsa2hld3Z2cWpwZXJydXh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxNTE1NTgsImV4cCI6MjA4MTcyNzU1OH0.9qiUMOAFP_a2V6eKYpTsiG9jbmnW4d5-NDmP-nlni7E"       // Replace with your anon/public key
  );

async function fetchPapers() {
  const urlParams = new URLSearchParams(window.location.search);
  const sem = Number(urlParams.get("sem")); // convert to number
  const { data, error } = await Supabase
    .from("bubcapyqs")
    .select("*")
    .eq("semester",sem)
    .eq("status",'approved')

;

const papersDiv=document.getElementById("papers");

  if (error) {
    console.error(error);
    return;
  }


  if (data.length==0) {
      papersDiv.textContent = `No papers available yet for semester ${sem}`;
    } else {
      data.forEach(paper => {

        const{data:urlData}=Supabase.storage
      .from("bubcapyqs")
      .getPublicUrl(paper.file_url);

        const a = document.createElement("a");
        a.href = urlData.publicUrl;
        a.textContent = `Sem ${sem} - ${paper.year} PYQs`;
        a.download = "";
        a.onclick = () => {
        gtag('event', 'pyq_download', {
          semester: sem,
          year: paper.year
        });
      };
        papersDiv.appendChild(a);
        papersDiv.appendChild(document.createElement("br"));
        papersDiv.appendChild(document.createElement("br"));
      });
    }

  document.getElementById("title").textContent =
      `Semester ${sem} Question Papers`;
}

fetchPapers();
</script>


</body>
</html>
